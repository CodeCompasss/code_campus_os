#!/bin/bash
# ======================================
# ğŸ”§ Universal Dev Tool Checker & Installer
# ======================================

GREEN="\e[32m"
RED="\e[31m"
YELLOW="\e[33m"
BLUE="\e[34m"
RESET="\e[0m"

installed=()
missing=()

check_cmd() {
    local cmd="$1"
    local label="${2:-$cmd}"
    if command -v "$cmd" &>/dev/null; then
        echo -e "${GREEN}âœ… $label is installed${RESET}"
        installed+=("$label")
    else
        echo -e "${RED}âŒ $label is missing${RESET}"
        missing+=("$label")
    fi
}

echo -e "${BLUE}ğŸ” Checking core tools...${RESET}"
for t in gcc g++ gdb clang lldb; do check_cmd "$t"; done

echo -e "\n${BLUE}ğŸ§± Checking build utilities...${RESET}"
for t in make flex bison dosbox nasm; do check_cmd "$t"; done

echo -e "\n${BLUE}ğŸŒ Checking languages and runtimes...${RESET}"
check_cmd python3
check_cmd pip3
check_cmd java "Java (JDK)"
check_cmd mvn "Maven"
check_cmd gradle
check_cmd node "Node.js"
check_cmd npm "npm"
check_cmd rustc "Rust Compiler"
check_cmd cargo "Cargo"

echo -e "\n${BLUE}ğŸ’» Checking editors and terminals...${RESET}"
check_cmd alacritty
check_cmd nvim "Neovim"
check_cmd vim
check_cmd code "VSCode"
check_cmd zsh
check_cmd tmux

echo -e "\n${BLUE}ğŸ§° Checking system tools...${RESET}"
check_cmd git
check_cmd gh "GitHub CLI"
check_cmd fzf
check_cmd tldr
check_cmd ranger
check_cmd neofetch
check_cmd btop
check_cmd lazygit
check_cmd rg "ripgrep"
check_cmd exa
check_cmd bat

echo -e "\n${BLUE}ğŸ—„ï¸ Checking databases & containers...${RESET}"
check_cmd mysql "MySQL"
check_cmd docker
check_cmd docker-compose

echo -e "\n${BLUE}ğŸŒ Checking network & SSH tools...${RESET}"
check_cmd ssh
check_cmd rsync

echo -e "\n${BLUE}ğŸŒŸ Checking custom dev configs...${RESET}"

# zsh already checked above, but keeping it for clarity
check_cmd zsh

# Powerlevel10k theme
if [ -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k" ]; then
    echo -e "${GREEN}âœ… Powerlevel10k theme installed${RESET}"
    installed+=("Powerlevel10k")
else
    echo -e "${RED}âŒ Powerlevel10k theme missing${RESET}"
    missing+=("Powerlevel10k")
fi

# LazyVim config
if [ -d "$HOME/.config/nvim" ] && [ "$(ls -A $HOME/.config/nvim)" ]; then
    echo -e "${GREEN}âœ… LazyVim Neovim config present${RESET}"
    installed+=("LazyVim")
else
    echo -e "${RED}âŒ LazyVim Neovim config missing${RESET}"
    missing+=("LazyVim")
fi


# ==============================
# âœ… Summary Section
# ==============================
echo -e "\n${YELLOW}======================================"
echo -e "ğŸ“‹ SUMMARY"
echo -e "======================================${RESET}"

if [ ${#installed[@]} -gt 0 ]; then
    echo -e "${GREEN}ğŸŸ© Installed tools (${#installed[@]}):${RESET}"
    printf "  %s\n" "${installed[@]}"
fi

if [ ${#missing[@]} -gt 0 ]; then
    echo -e "\n${RED}ğŸŸ¥ Missing tools (${#missing[@]}):${RESET}"
    printf "  %s\n" "${missing[@]}"
else
    echo -e "\n${GREEN}ğŸ‰ All tools are installed!${RESET}"
fi

# ==============================
# âš™ï¸ Optional Auto Installer
# ==============================
if [ ${#missing[@]} -gt 0 ]; then
    echo -e "\n${YELLOW}âš™ï¸ Would you like to install missing tools now? (y/n)${RESET}"
    read -r answer
    if [[ "$answer" =~ ^[Yy]$ ]]; then
        echo -e "${BLUE}ğŸ“¦ Installing missing tools...${RESET}"
        sudo apt update -qq
        for tool in "${missing[@]}"; do
            sudo apt install -y "$tool" 2>/dev/null || echo -e "${RED}âš ï¸ Failed to install $tool${RESET}"
        done
        echo -e "${GREEN}âœ… Installation attempt complete.${RESET}"
    else
        echo -e "${YELLOW}ğŸš« Skipped installation.${RESET}"
    fi
fi

echo -e "\n${BLUE}âœ… Version check and summary complete.${RESET}"
